# YMIR 中文文档

## 简介

Hi，您好，欢迎使用YMIR模型生产平台。YMIR系统为算法人员提供端到端的算法研发工具，围绕AI开发过程中所需要数据处理、模型训练等业务需求提供一站式服务，推动算法技术进步。目前，YMIR系统支持物体检测类模型训练。主要用于检测图中每个物体的位置、名称。适合图中有多个主体要识别、或要识别主体位置及数量的场景。


## 专用名词

- 类别/Class：类别一般指用户添加到YMIR系统下的关键词，这类关键词通常用于训练、标注，即用户想要在图像中检测出来的目标物体。
- 类别别名/Alias：别名一般和类别的主名对应，当用户为某一个类别添加了别名后，该别名对应的标注框将会在训练中按类别主名来分类训练。
- 数据标签/Asset Tag ：单个图像数据所带有的标签分类，一般指图像的某个属性，如该图像的来源地点、所属场景等。
- 标注框标签/Box Tag：单个标注框所带有的标签分类，一般指标注框的某个属性，如该标注框的质量、分辨率等。
- 训练目标/Target：训练目标由用户在类别中选取，即当前要训练的模型想要检测的目标物体。
- 镜像/DockerImage：运行训练、挖掘和推理任务的环境，YMIR系统提供一些默认镜像，也支持用户自行开发上传。
- 标准值/GT：数据集中正确的标注值，作为待识别目标的参考标注，一般情况下为人工标注。
- 预测标注/Prediction：数据集经过模型推理后产生的推理结果，用于评估模型的识别效果。
- 迭代流程


## 使用流程

YMIR系统的使用流程一般分为两类，一类是训练模型的基本流程，如下图所示，全程可视化简易操作。

这里插入一个流程图

一类是系统提供的迭代流程，将模型训练中的关键步骤进行拆解，辅助用户填入数据，支持用户流程化地优化模型，获得最终的训练结果。了解更多迭代相关的操作，请跳转至【开启迭代】。（这里加一个跳转到迭代的链接）

接下来我们将详细讲述每个步骤的具体操作，如果有其他问题，请发送邮件到contact.viesc@gmail.com进行反馈。


### 创建项目

首先，我们需要在项目管理中【创建项目】，YMIR系统以项目为维度进行数据、模型的管理。


请注意，项目的训练目标将会默认设为您在启用【迭代流程】时的训练目标。

（这里加一个创建项目的视频链接）

### 添加数据集

项目创建完成后，在训练之前需要在项目中【添加数据集】，导入并标注数据。

#### 添加类别

在上传之前确定想要识别哪几种物体，并上传含有这些物体的数据集。每个类别对应想要在图片中检测出的一种物体，并将对应的类别添加到【类别管理】中。

#### 准备数据集

基于添加好的类别准备数据集，格式要求如下：

- 仅支持zip格式压缩包文件上传；
- 局域网内上传压缩包大小<1G, 互联网建议<200MB；
- 目前支持图片类型为png、jpg、bmp、jpeg，格式不符的图片将不会导入；
- 如果需要同步导入标注文件，则标注的文件格式需要为Pascal VOC；
- 压缩包文件内图片文件需放入images文件夹内，标准值文件需放入gt文件夹内，推理结果文件需放入pred文件夹内，且pred文件夹内应包含产生该推理结果的模型信息。gt和pred均为可选，如不上传，则需要该文件夹为空，压缩包内文件结构如下。点击下载示例文件：[Sample.zip](http://192.168.13.144:26001/sample_dataset.zip)

#### 上传数据集

在完成了添加类别与数据准备后，点击【添加数据集】按钮，进入添加数据集页面。


可以通过以下方式导入数据：

①用户本地数据：支持上传压缩包，或通过网络url、路径导入。


②平台已有数据：支持复制该用户下的其他数据集或导入平台已有的公共数据集。


### 数据标注

上传的数据集如果不包含标注文件或用户需要重新标注，即可进入数据标注页面进行标注。

Step 1 首先选择要标注的数据集，点击[标注]操作，创建标注任务。


Step 2 填写标注需要的内容，如果用户尚未注册标注平台的账户，可点击下方链接跳转至标注平台注册账号。


Step 3 标注任务创建完成后，会将任务下发到您所填写的标注平台账号下，用户可以通过查看标注数据集的详情，跳转至标注平台自行标注。


### 数据分析

您可从【项目管理】下左侧菜单操作列点击【数据集分析】进入该功能页面。

数据分析旨在对您数据集中的图像数据进行质量检测，通过提供客观指标，为您对数据集的下一步操作（标注、训练、诊断等）进行参照引导。

整体质检报告将包括对标准值、预测标注两个层面的指标进行统计。

分析结果分为整体指标和分布指标两类。整体指标包括数据集存储大小、标注框总数、图片平均标注框数量、以及已标注图片占比四类；分布指标包括图像存储大小分布、图像高宽比分布、图像分辨率分布、图像质量分布、标注框分辨率分布以及类别占比分布六类。

可以通过切换数据集查看不同数据集下的分析报告，支持多选数据集进行比对。

### 模型训练

#### 功能页面

您可从【项目管理】下左侧菜单操作列点击【模型训练】进入该功能页面。

如果有指定的数据集作为训练集，也可以在数据集的右侧操作入口中进入训练页面。


#### 训练配置

①选择镜像

选择此次训练的需要的镜像容器，YMIR提供默认的开发镜像，支持yolo v5训练。如需要其他镜像，可参考【镜像开发文档】自行开发，也可以由管理员前往【我的镜像】-【公共镜像】列表页面拉取更多镜像，具体操作参考【镜像管理】。

②选择训练集

选择您想要用于当前模型训练的数据集，数据集可选列表为当前项目下的数据集，无法跨项目选取。注意请确保选中的数据集已经完成数据标注，否则无法启动训练，在数据集标注质量较高的情况下，可能获得的模型效果也会更好。

③选择训练目标

训练目标为您本次训练想要识别的物体类别，仅支持在已选中训练集的类别列表中选择，选择完成之后可点击【正负样本比例计算】按钮计算当前选中类别在训练集中的占比。

④选择验证集

AI模型在训练时，每训练一批数据会进行模型效果检验，以某一张验证图片作为验证数据，通过验证结果反馈去调节训练。因此，需要选择一个与训练目标类别一致的数据集作为验证集，用于模型效果的提升。

⑤预训练模型

预训练模型：在模型迭代训练时，用户在原训练数据上增加了训练数据，可通过加载原训练数据训练的模型参数进行模型训练。这样可让模型收敛速度变快，训练时间变短，同时在数据集质量较高的情况下，可能获得的模型效果也会更好。

注：仅可选择同一训练镜像下训练出的模型作为预训练模型。

⑥GPU个数

目前YMIR仅支持GPU训练，可以在这里调整用于本次训练的GPU数量，合理分配资源。

⑦超参数配置

超参数配置开关默认关闭，建议对深度学习有一定了解的用户根据实际情况考虑使用，超参数配置目前提供「最长边长缩放」配置项。

- 最长边长缩放：可以输入的数值调整训练数据的图像尺寸，将图像的最长边设为您所设置的数值，其他边长按比例缩放。

#### 训练模型

点击「开始训练」，训练模型。

- 训练时间与数据量大小有关，1000张图片可能需要几个小时训练，请耐心等待。
- 模型训练过程中，可以到【模型列表】页面查看模型的训练进度。
- 想要查看更多的模型训练过程中的信息，可打开【模型详情】页面，点击【训练过程】按钮，查看训练信息。


这里贴一个tensorflow的图


### 模型诊断 

可通过模型推理或者模型诊断了解模型效果：

- 模型推理：通过模型的【推理】操作，在选中的测试集上生成推理结果，可以对推理结果进行可视化查看。
- 模型诊断：可以在【项目管理】的左侧导航栏中找到【模型诊断】模块，在线评估模型的效果。具体操作为：①选中你要评估的模型，②选择测试集（选中的测试集需要在模型上已完成推理），③调整评估参数，点击诊断。
- 可以通过切换指标来查看不同参数下的模型诊断结果，诊断结果包括mAP、PR曲线、精确率、召回率。显示结果示例如下：

查看模型诊断结果时，需要思考在当前业务场景，更关注精确率与召回率哪个指标。是更希望减少误识别，还是更希望减少漏识别。前者更需要关注精确率的指标，后者更需要关注召回率的指标。评估指标说明如下：

- mAP： mAP(mean average precision)是物体检测(Object Detection)算法中衡量算法效果的指标。对于物体检测任务，每一类object都可以计算出其精确率(Precision)和召回率(Recall)，在不同阈值下多次计算/试验，每个类都可以得到一条P-R曲线，曲线下的面积就是average
- 精确率： 正确预测的物体数与预测物体总数之比。
- 召回率： 正确预测的物体数与真实物体数之比。

### 模型迭代

#### 功能概述

一个模型很难一次性就训练到最佳的效果，可能需要结合模型推理结果和诊断数据不断扩充数据和调优。

为此我们设计了模型迭代功能，下图为一个完整的模型迭代流程，用户通过多次迭代，不断地调整训练数据和算法，多次训练，获得更好的模型效果。

此处插入模型迭代流程图

开启迭代后，YMIR提供标准化的模型迭代流程，并且会在每一步操作中帮助用户默认填入上一次的操作结果，普通用户按照既定步骤操作，即可完成完整的模型迭代流程。当前操作结果如不符合您的预期，您也可以选择跳过当前操作。

#### 功能入口

创建项目完成后，您可以在【项目概览页面】中点击【进入迭代】按钮进入该页面，也可以直接从【项目管理】下左侧菜单操作列点击【项目迭代】进入。

#### 迭代前准备

开启迭代需要用户准备好要使用的数据集以及初始模型，各类数据的作用如下：

- 训练集：用于训练的初始数据，训练集的类别需要包含当前项目的目标。训
练会在每次迭代的过程中通过版本更新的方式不断地扩充。
- 挖掘集：这类数据集数量较多且可以尚未标注目标类别，一般来源于现场数据，通过挖掘后可以在其中找出优质数据，用于扩充训练数据。当用户认为挖掘集中已无有价值数据，可以自行替换。
- 验证集：用于在模型的训练过程中校验数据，模型迭代过程中使用统一的验
证参与训练，可以更好地比对模型训练效果。
- 初始模型：首次迭代用于挖掘的模型，可以由用户自行导入，也支持由用户通过导入后的训练集自行训练。
- 挖掘策略：

以上数据准备完成后，点击【开启迭代】，进入迭代流程。

#### 迭代流程

step1 挖掘数据准备

该操作用于确定待挖掘的数据，迭代系统会辅助用户根据迭代开启前设置的挖掘策略，在所选挖掘集上进行数据筛选或去重，最终获得的结果就是下一步用于挖掘的数据。

step2 数据挖掘

数据挖掘的主要目的是为了再未标注的数据中找到有利于模型训练的数据，从而降低标注成本。YMIR提供成熟的挖掘算法，根据上一步获取到的待挖掘数据， 设置用户想要挖掘的数据量，其他参数均有迭代系统辅助填写，注意，这里用于挖掘的模型是您上次迭代获取到的最终训练模型（如果是第一次迭代，则这里是您设置的初始模型），点击【确认】后获取挖掘结果数据。

step3 数据标注

挖掘后的结果一般不带有用户想要训练的目标类别标注，这是需要对挖掘结果进行人工标注，在迭代流程中点击【数据标注】，进入标注页面， 具体操作参考【数据标注】。

step4 更新训练集

迭代的主要目的是扩充用户的训练数据，将已经标注好的挖掘结果合并到之前的训练集中，生成新的训练集版本，用于模型训练。

step5 模型训练

已合并后的训练集需要再次进行训练产生新的模型，注意，这里的验证集是用户在迭代前所设置的验证集，为了保证模型效果的一致性，暂不支持更改。点击【训练】后获得本次迭代的模型结果，如果效果未达到您的要求，可以继续进行下一次迭代。
